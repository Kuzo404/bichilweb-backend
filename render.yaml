services:
  - type: web
    name: bichilweb-backend
    env: python
    region: oregon
    plan: standard
    buildCommand: >
      pip install -r requirements.txt &&
      python manage.py migrate
    startCommand: gunicorn bichilglobusweb.wsgi:application --bind 0.0.0.0:$PORT
    envVars:
      - key: DEBUG
        value: "False"
      - key: ALLOWED_HOSTS
        value: "bichilweb-backend.onrender.com,localhost,127.0.0.1"
      - key: CORS_ALLOWED_ORIGINS
        value: "https://bichilweb.onrender.com,http://localhost:3000,http://localhost:3001"
      - key: STATIC_ROOT
        value: "/opt/render/project/src/staticfiles"
      - key: MEDIA_ROOT
        value: "/opt/render/project/src/media"
      - key: MEDIA_URL
        value: "/media/"

    # Persistent disk for media files
    disk:
      name: media-storage
      mountPath: /opt/render/project/src/media
      sizeGB: 5

    # Serve media files as static
    staticPreCompile: false
